# MD380-Codeplug
Classes for handling .rdt codeplug files for Tytera MD-380 (and possibly other) radios.

## Warning

This software can be used to generate a .rdt codeplug file which can be written
to a Tytera MD-380 radio.  This has not been thoroughly tested yet, and there
may be a risk of damage to your radio.  You have been warned, and it ain't my
fault if you hose your radio, mkay?

## Codeplug

```js
const fs = require('fs');
const Codeplug = require('/path/to/MD380-Codeplug/index.js');

// Load an existing codeplug
const codeplug = new Codeplug(fs.readFileSync('/path/to/some/codeplug.rdt'));
// Show the current radio name
console.log(codeplug.settings.radio_name);
// Change the radio name
codeplug.settings.radio_name = 'Poopypants';
// Write the modified codeplug to another file
fs.writeFileSync('/path/to/my/newcodeplug.rdt', codeplug.serialize());

// Create a blank codeplug
const newplug = new Codeplug();
// Change some settings
newplug.settings.radio_name = "MD-380";
newplug.settings.radio_id = 1234567;
// Write it to a file
fs.writeFileSync('/path/to/my/othercodeplug.rdt', newplug.serialize());
```

### Methods

- resequence()
  - Sorts data within the Codeplug object so that all populated records appear sequentially within their sections
  - Updates references between various sections so that they point to the correct indexes after sortation
  - Is very slow and inefficient; sorry; I'll fix that someday
  - This is automatically called within 'serialize()'
  - May be worth calling before using 'JSONify()', but probably not
- serialize()
  - Returns a Buffer which can then be written to a file
- JSONify(full)
  - Returns a String of JSON representing the codeplug in its current state
  - Boolean 'full' specifies whether to include deleted / unpopulated records in the JSON dump
    - A blank/default codeplug produces about 4 KB of JSON
	- A complete codeplug produces about 1.3 MB of JSON

### Properties

See _lib/map.js_ for names and types of sub-properties which can be read and
written.

- settings
- menu_items
- button_definitions
- one_touch_access
- quick_contact
- text_messages
- contacts
- receive_groups
- zones
- scan_lists
- channels

## Notes

When creating an instance of Codeplug, you can pass in a Buffer containing the
contents of a codeplug file.  If you do not pass in a Buffer, a default codeplug
will be loaded from _lib/default1.rdt_.  This default codeplug was generated by
the CPS MD380 Programming Software V1.34 for Windows, for a 400-480MHz MD-380,
MCU Version D013.020.

The file _lib/map.js_ describes the layout of a codeplug file, and includes
comments about types of properties therein, what the values mean, and what
values are valid.  Several placeholder sections (with names like 'uncharted_1')
are included; these areas will be loaded from one Buffer and then written
unmodified to another when you call Codeplug.serialize().  'Uncharted' sections
are: 'Privacy Setting', 'Digit Emergency System', and 'DTMF Signalling'.  I
have mostly mapped out these areas but haven't bothered with parsing them; see
comments in _lib/map.js_ for information on the data in these sections.

I have no idea what the ramifications might be of reading in a codeplug file
from one type of radio (a UHF MD-380, for example), modifying it, writing it,
then uploading it to a different model of radio (a VHF MD-380, for example), or
what differences there may be between codeplugs with different "MCU Version"
settings in the 'Basic Information' area.

## Acknowledgements

IZ2UUF for [this document](http://www.iz2uuf.net/wp/index.php/2016/06/04/tytera-dm380-codeplug-binary-format/),
mapping much of the codeplug file format.
